# Important

1. This does not work with FGMFoam right now. On my system the tables are read and then the solver crashes during the interpolation step.

2. These scripts are generated by AI. Use with caution. No warranty expressed or implied. Please do not ask me for support.

3. If you develop a set of working scripts for FGMFoam please kindly share with the community.

# FGMFoam directory

The original file is given here: https://www.tfd.chalmers.se/~hani/kurser/OS_CFD/ then replicated from https://github.com/drhcelik/fgmFoam. 

Original work: "Description of the reacting flow solver FGMFoam, Michael Bertsch"

FGMFoam uses OpenFOAM 7.

Warning warning warning - the scripts generated using the scripts below move the community forward, but do not fully work.

# Script instructions

**Flamelets → per-point CSV → (Z,PV) tables → OpenFOAM dictionaries**

1. `generate1DFlamelets.py` creates 1-D counter-flow diffusion flamelets over a strain sweep (saved as `strain_loop_XX.yaml/csv`). The user controls air/fuel, mass-fluxes, mesh/refinement, ignition, and recentering. This script is written for GRI30
(all species) mechanism with Cantera v3.1. The user should edit this scrip to control fuel/air, transport model, recentering, etc.

`python3 generate1DFlamelets.py`


2. `organizeData.py` loads each flamelet, computes derived scalars (**mixture fraction Z**, **progress variable PV**, **χZ proxy**, **stretch rate Sₙ**), and writes flat CSVs `post_strain_loop_XX.csv`

`python3 organizeData.py`

3. `build_fgm_tables.py` bins all CSV points onto a regular **Z×PV** grid using **Favre (ρ-weighted) averages**, writes:

   ```
   axes/Z.csv, axes/PV.csv
   thermo/T.csv, thermo/rho.csv
   species/Y_<name>.csv
   ```

   and packs them as `02_tables/` (or `.tar.xz`).
   
`python3 build_fgm_tables.py`

Note that if you are using the FGMFoam Distribution with an `02_tables` directory, make a backup and 
remove that directory before running `python3 build_fgm_tables.py`.

4. Convert CSV bundle to OpenFOAM dictionaries (optional)
`csv2of_tables.py` writes `constant/tables/*_table` **with** `dimensions` and also creates 
`constant/tableProperties` and `constant/PVtableProperties`. It can optionally compute `mu/Cps/alpha/psi` via 
Cantera or add `PVmin/PVmax/SourcePV`. This step is mainly to seed `tableProperties` 
and for solvers that accept simple 2-D tables. 

```
python3 csv2of_tables.py   --in ./02_tables   --out ./03_testcase   --mech gri30.yaml --pressure 101325   --emit-pv-bounds --emit-zero-sourcepv
```

5. Write FGM/PV tables in the *LDMtable* format that FGMFoam expects.

LDMtable the **nested OpenFOAM dictionary layout** used by FGMFoam’s LDMTable reader: 
a hierarchy that reflects `(varPV → PV → varZ → Z)` with explicit counts and parenthesized lists—but 
**without** OpenFOAM `dimensions` entries. `ldm_from_02tables_nodim.py` writes that nested structure, 
sourcing `Z_param/PV_param/varZ_param/varPV_param` from `tableProperties` so the shapes line up with FGMFoam's expectations. 

```
# Write nested LDM tables where the solver will look (tablePath="tables")
python3 ldm_from_02tables_nodim.py \
  --inp 02_tables \
  --case 03_testcase \
  --tablePath ./table/ \
  --emit T rho Y_all SourcePV YWI YuWI YbWI PVmin PVmax Yu2I YuYbI Yb2I
```

This uses the Z/PV grid from 02_tables and the grid parameters in
`03_testcase/constant/tableProperties` to write nested files to `03_testcase/constant/tables/`.

